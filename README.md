# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.


#### Данные:
Интерфейс товара:
`interface IProduct {id: string; description: string; image: string; title: string; category: string; price: number | null}` - 
описывает данные товара, с которыми работает приложение. Сюда входят: корзина, каталог.

Интерфейс покупателя: `interface IBuyer {payment: TPayment; email: string; phone: string; address: string;}` - 
описывает данные покупателя, с которыми работает приложение, это форма оформления заказа.

Класс `Каталог товаров - ProductCatalog`:  
- Хранит массив всех товаров
- Хранит товар, выбранный для подробного отображения;
- Содержит методы:  
    1. сохранение массива товаров полученного в параметрах метода.
    2.  получение массива товаров из модели;
  3. получение одного товара по его id;
  4. сохранение товара для подробного отображения;
  5. получение товара для подробного отображения.

Поля класса `Каталог товаров`:

- `products: IProduct[]` - тип данных - описывается в интерфейсе IProduct. Хранит
список всех товаров.
- `selectedProduct: IProduct` - тип данных - описывается в интерфейсе IProduct. Хранит
в себе выбранный пользователем товар с подробным описанием.

Методы класса `Каталог товаров`:

- `setProducts(products: IProduct[]): void` - сохранение всего списка товаров, полученного в параметрах метода
- `getProducts(): IProduct[]` - получение списка продуктов
- `getProductById(id: string): IProduct | undefined` - получение продукта из всего списка по его идентификатору
- `setSelectedProduct(product: IProduct): void` - сохранение товара для подробного отображения
- `getSelectedProduct(): IProduct | null` - получение товара для подробного отображения


Класс `Корзина - Basket`:
- хранит массив товаров, выбранных покупателем для покупки.
- Содержит методы:
    1. получение массива товаров, которые находятся в корзине;
    2.  добавление товара, который был получен в параметре, в массив корзины;
    3. очистка корзины;
    4. получение стоимости всех товаров в корзине;
    5. получение количества товаров в корзине;
  6. проверка наличия товара в корзине по его id, полученного в параметр метода.

Поля класса `Корзина`:

- `private products: IProduct[];` - хранит все товары в корзине.

Методы класса `Корзина`:

- `getProductsCart(): IProduct[]` - получение массива всех товаров в корзине.
- `setProductCart(product: IProduct)` - Добавление товара в корзину
- `clearingCart()` - очистка корзины полностью!
- `removeProduct(product: IProduct)` - удаление конкретного товара из корзины
- `cartCost(): number` - расчет суммы всех товаров в корзине
- `quantityProductsCart(): number` - определение кол-ва товаров в корзине
- `productInCart(productId: string): boolean` - определение наличия товара в корзине по его идентификатору



Класс `Покупатель - Buyer`:
- Хранит такие данные как: вид оплаты, адрес, телефон, email
- Содержит методы:
    1. сохранение данных в модели. Один общий метод или отдельные методы для каждого поля. Важно учесть, что должна быть реализована возможность сохранить только одно значение, например, только адрес или только телефон, не удалив при этом значения других полей, которые уже могут храниться в классе;
    2.  получение всех данных покупателя;
    3. очистка данных покупателя;
    4. получение стоимости всех товаров в корзине;
    5. получение количества товаров в корзине;
    6. валидация данных. Обратите внимание, что правила валидации описаны в функциональных требованиях. Поле является валидным, если оно не пустое. Метод валидации должен давать возможность определить не только валидность каждого отдельного поля, но и предоставлять информацию об ошибке, связанной с проверкой конкретного значения.

Поля класса `Покупатель`:

- `private payment: string | null;` - хранит вид оплаты
- `private email: string;` - хранит почту покупателя
- `private phone: string;` - хранит номер телефона покупателя
- `private address: string;` - хранит адрес покупателя

Метода класса `Покупатель`:

- `setPayment(payment: string)` - изменение/добавление типа оплаты
- `setEmail(email: string)` - изменение/добавление email покупателя
- `setPhone(phone: string)` - изменение/добавление телефона покупателя
- `setAddress(address: string)` - изменение/добавление адреса покупателя
- `getData(): IBuyer` - получение всех данных введенных пользователем
- `clear()` - очистка данных пользователя
- `validate(): Validation` - валидация данных от пользователя и организация ошибок


#### Слой коммуникации:

Класс коммуникации `LarekApi`:

- Принимает на вход стандарный класс Api
- Служит как передатчик данных от клиента к серверу.

Метода класса `LarekApi`:

- `async getProductList(): Promise<IProduct[]>` - делает запрос на эндпоинт /product/, запрашивая массив товаров
- `async submitOrder(orderData: IOrderRequest): Promise<IOrderResult>` - отправляет данные покупателя и корзины на сервер для дальнейшей обработки
- `createOrderRequest(buyerData: IBuyer, productIds: string[]): IOrderRequest` - создание объекта данных для отправки на сервер

# Модели представления и события в main.ts
## Card(базовый класс)
`Назначение` - Базовый класс для карточек товаров

### Поля:

- `cardTitle: HTMLElement` - заголовок карточки
- `cardPrice: HTMLElement` - цена товара


## CardCatalog
`Назначение` - Карточка товара в каталоге
`Наследует:` - Card`<TCardCatalog>`

### Поля:

- `imageElement: HTMLImageElement` - изображение товара
- `categoryElement: HTMLElement` - категория товара


## CardPreview
`Назначение` - Детальная карточка товара в модальном окне
`Наследует:` - Card`<TCardPreview>`

### Поля:

- `descriptionElement: HTMLElement` - описание товара
- `cardBuyButton: HTMLButtonElement` - кнопка покупки

## CardBasket
`Назначение` - Карточка товара в корзине
`Наследует:` - Card`<TCardBasket>`

### Поля:

- `indexElement: HTMLElement` - индекс товара
- `delButtonElement: HTMLButtonElement` - кнопка удаления

## BasketView
`Назначение` - Представление корзины покупок

### Поля:

- `basketList: HTMLUListElement` - список товаров
- `basketPrice: HTMLElement` - общая стоимость
- `basketNewOrder: HTMLButtonElement` - кнопка оформления заказа

## Modal
`Назначение` - Управление модальными окнами

### Поля:

- `buttonClose: HTMLButtonElement` - кнопка закрытия
- `contentElement: HTMLElement` - контент модального окна

### Методы:

- `open(): void` - открытие модального окна
- `close(): void` - закрытие модального окна


## Form (Абстрактный класс)
`Назначение` - Базовый класс для форм

### Методы:

- `protected validate(): boolean` - абстрактный метод валидации
- `protected getFormData(): T` - абстрактный метод получения данных
- `setErrors(messages: string[]): void` - установка ошибок
- `setValid(valid: boolean): void` - установка валидности


## OrderForm
`Назначение` - Форма оформления заказа
`Наследует:` - Form`<IOrderFormData>`

## ContactsForm
`Назначение` - Форма контактных данных
`Наследует:` - Form`<IContactsFormData>`

### Основные события:

#### Каталог товаров:

- `products:changed` - изменение списка товаров

- `card:selected` - выбор карточки товара

- `product:selected` - выбор товара для просмотра

- `product:toBasket` - добавление товара в корзину

#### Корзина:
- `basket:open` - открытие корзины

- `basket:deleteProduct` - удаление товара из корзины

- `basket-list:change` - изменение содержимого корзины

- `basket:orderNew` - начало оформления заказа

#### Модальные окна:
- `modal:close` - закрытие модального окна

- `success:close` - закрытие окна успешного заказа

### Основные конструкторы слоя представления:

`constructor(protected container: HTMLElement, actions?: TYPE)`:

- container - определяет HTMLElement, в котором будет генерироваться контент
- actions - параметр для передачи события с данными, например: данные о товаре

`constructor(container: HTMLElement, protected events: IEvents)`:
- events - используется для инициализации события и его обработке

### Формула работы с данными (MVP архитектура):

- Слой представления = V
- Слой коммуникации = P
- Слой данных - M

## Формула:

- V-P-M-P-V